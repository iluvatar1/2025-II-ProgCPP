Bootstrap: docker
From: ubuntu:devel
Stage: spython-base

%files
    # Copy main.cpp directly to the target folder inside the container
    main.cpp /app/main.cpp

%post
    # 1. Install Build Tools
    apt-get update && apt-get install -y \
    build-essential \
    wget \
    tar \
    libgl1-mesa-dev \
    libx11-dev \
    libxcursor-dev \
    libxrandr-dev \
    libxinerama-dev \
    libxi-dev \
    && rm -rf /var/lib/apt/lists/*

    # 2. Download Raylib Binaries 
    mkdir -p /opt
    cd /opt
    wget https://github.com/raysan5/raylib/releases/download/5.5/raylib-5.5_linux_amd64.tar.gz \
    && tar -xzf raylib-5.5_linux_amd64.tar.gz \
    && rm raylib-5.5_linux_amd64.tar.gz

    # Define variable for build time
    RAYLIB_PATH="/opt/raylib-5.5_linux_amd64"
    
    # 3. Go to the project directory where we copied the file
    cd /app

    # 4. Compile
    # Note: LD_LIBRARY_PATH isn't strictly needed at compile time (only -L is), 
    # but it is needed at runtime.
    g++ main.cpp -o app \
    -I${RAYLIB_PATH}/include \
    -L${RAYLIB_PATH}/lib \
    -lraylib \
    -lGL -lm -lpthread -ldl -lrt -lX11

%environment
    export RAYLIB_PATH="/opt/raylib-5.5_linux_amd64"
    # Essential so the app can find libraylib.so at runtime
    export LD_LIBRARY_PATH="$RAYLIB_PATH/lib:$LD_LIBRARY_PATH"

%runscript
    cd /app
    # REMOVED "/bin/bash" - This is a compiled binary, not a shell script
    ./app "$@"

%startscript
    cd /app
    ./app "$@"